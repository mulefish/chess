<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Board</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f4f4f4;
        }
        .chess-board {
            display: grid;
            grid-template-columns: repeat(8, 60px);
            grid-template-rows: repeat(8, 60px);
            border: 2px solid #000;
        }
        .cell {
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 32px;
        }
        .black {
            background-color: #769656;
        }
        .white {
            background-color: #eeeed2;
        }
        .highlight {
            background-color: yellow !important;
        }
        .chess-piece {
            pointer-events: none; /* Prevent selection */
        }
    </style>
</head>
<body>
ZOOM
<br/>
    <div id="chess-board" class="chess-board"></div>
    <script src="{{ url_for('static', filename='version2_setup.js') }}"></script>
    <script src="{{ url_for('static', filename='version2.js') }}"></script>

    <!-- <script>
        const PAWN_B = '<i class="fas fa-chess-pawn" style="color: black; font-size: 48px;"></i>';
        const ROOK_B = '<i class="fas fa-chess-rook" style="color: black; font-size: 48px;"></i>';
        const KNIGHT_B = '<i class="fas fa-chess-knight" style="color: black; font-size: 48px;"></i>';
        const BISHOP_B = '<i class="fas fa-chess-bishop" style="color: black; font-size: 48px;"></i>';
        const QUEEN_B = '<i class="fas fa-chess-queen" style="color: black; font-size: 48px;"></i>';
        const KING_B = '<i class="fas fa-chess-king" style="color: black; font-size: 48px;"></i>';
        const ROOK_W = '<i class="fas fa-chess-rook" style="color: tan; font-size: 48px;"></i>';
        const KNIGHT_W = '<i class="fas fa-chess-knight" style="color: tan; font-size: 48px;"></i>';
        const BISHOP_W = '<i class="fas fa-chess-bishop" style="color: tan; font-size: 48px;"></i>';
        const QUEEN_W = '<i class="fas fa-chess-queen" style="color: tan; font-size: 48px;"></i>';
        const KING_W = '<i class="fas fa-chess-king" style="color: tan; font-size: 48px;"></i>';
        const PAWN_W = '<i class="fas fa-chess-pawn" style="color: tan; font-size: 48px;"></i>';

        class Piece {
            constructor(icon, row, col, type, color) {
                this.icon = icon;
                this.row = row;
                this.col = col;
                this.type = type;
                this.color = color;
            }

            getPossibleMoves(board) {
                let moves = [];
                switch (this.type) {
                    case 'pawn':
                        const direction = this.color === 'white' ? -1 : 1;
                        const forwardRow = this.row + direction;
                        if (board[forwardRow] && !board[forwardRow][this.col]) {
                            moves.push([forwardRow, this.col]);
                        }
                        break;
                    case 'rook':
                        moves = this.getLinearMoves(board, [[1, 0], [0, 1], [-1, 0], [0, -1]]);
                        break;
                    case 'knight':
                        moves = this.getKnightMoves(board);
                        break;
                    case 'bishop':
                        moves = this.getLinearMoves(board, [[1, 1], [1, -1], [-1, 1], [-1, -1]]);
                        break;
                    case 'queen':
                        moves = this.getLinearMoves(board, [[1, 0], [0, 1], [-1, 0], [0, -1], [1, 1], [1, -1], [-1, 1], [-1, -1]]);
                        break;
                    case 'king':
                        moves = this.getLinearMoves(board, [[1, 0], [0, 1], [-1, 0], [0, -1], [1, 1], [1, -1], [-1, 1], [-1, -1]], 1);
                        break;
                }
                return moves;
            }

            getLinearMoves(board, directions, maxSteps = 8) {
                const moves = [];
                for (const [dr, dc] of directions) {
                    for (let step = 1; step <= maxSteps; step++) {
                        const newRow = this.row + dr * step;
                        const newCol = this.col + dc * step;
                        if (newRow < 0 || newRow >= 8 || newCol < 0 || newCol >= 8) break;
                        if (board[newRow][newCol]) {
                            // if (board[newRow][newCol].color !== this.color) {
                            //     moves.push([newRow, newCol]);
                            // }
                            break;
                        }
                        moves.push([newRow, newCol]);
                    }
                }
                return moves;
            }

    getKnightMoves(board) {
        const moves = [];
        const deltas = [
            [2, 1], [2, -1], [-2, 1], [-2, -1],
            [1, 2], [1, -2], [-1, 2], [-1, -2]
        ];
        for (const [dr, dc] of deltas) {
            const newRow = this.row + dr;
            const newCol = this.col + dc;
            if (newRow >= 0 && newRow < 8 && newCol >= 0 && newCol < 8) {
                if (!board[newRow][newCol]) {  // Only add the move if the cell is empty
                    moves.push([newRow, newCol]);
                }
            }
        }
        return moves;
    }



        }

        const boardState = Array(8).fill(null).map(() => Array(8).fill(null));
        const pieces = [
            new Piece(ROOK_B, 0, 0, 'rook', 'black'),
            new Piece(KNIGHT_B, 0, 1, 'knight', 'black'),
            new Piece(BISHOP_B, 0, 2, 'bishop', 'black'),
            new Piece(QUEEN_B, 0, 3, 'queen', 'black'),
            new Piece(KING_B, 0, 4, 'king', 'black'),
            new Piece(BISHOP_B, 0, 5, 'bishop', 'black'),
            new Piece(KNIGHT_B, 0, 6, 'knight', 'black'),
            new Piece(ROOK_B, 0, 7, 'rook', 'black'),
            new Piece(PAWN_B, 1, 0, 'pawn', 'black'), 
            new Piece(PAWN_B, 1, 1, 'pawn', 'black'), 
            new Piece(PAWN_B, 1, 2, 'pawn', 'black'), 
            new Piece(PAWN_B, 1, 3, 'pawn', 'black'), 
            // ...Array.from({ length: 8 }, (_, i) => new Piece(PAWN_B, 1, i, 'pawn', 'black')),
            new Piece(ROOK_W, 7, 0, 'rook', 'white'),
            new Piece(KNIGHT_W, 7, 1, 'knight', 'white'),
            new Piece(BISHOP_W, 7, 2, 'bishop', 'white'),
            new Piece(QUEEN_W, 7, 3, 'queen', 'white'),
            new Piece(KING_W, 7, 4, 'king', 'white'),
            new Piece(BISHOP_W, 7, 5, 'bishop', 'white'),
            new Piece(KNIGHT_W, 7, 6, 'knight', 'white'),
            new Piece(ROOK_W, 7, 7, 'rook', 'white'),
            ...Array.from({ length: 8 }, (_, i) => new Piece(PAWN_W, 6, i, 'pawn', 'white')),
        ];

        pieces.forEach(piece => {
            boardState[piece.row][piece.col] = piece;
        });

        const board = document.getElementById('chess-board');

        for (let row = 0; row < 8; row++) {
            for (let col = 0; col < 8; col++) {
                const cell = document.createElement('div');
                cell.className = `cell ${(row + col) % 2 === 0 ? 'white' : 'black'}`;
                cell.id = `${row}-${col}`;
                board.appendChild(cell);
            }
        }

        let selectedPiece = null;

        function highlightMoves(moves) {
            moves.forEach(([row, col]) => {
                const cell = document.getElementById(`${row}-${col}`);
                if (cell) {
                    cell.classList.add('highlight');
                    cell.addEventListener('click', movePiece);
                }
            });
        }

        function clearHighlights() {
            document.querySelectorAll('.highlight').forEach(cell => {
                cell.classList.remove('highlight');
                cell.removeEventListener('click', movePiece);
            });
        }

        // function movePiece(event) {
        //     if (!selectedPiece) return;

        //     const targetCell = event.target;
        //     const [targetRow, targetCol] = targetCell.id.split('-').map(Number);

        //     boardState[selectedPiece.row][selectedPiece.col] = null;
        //     selectedPiece.row = targetRow;
        //     selectedPiece.col = targetCol;
        //     boardState[targetRow][targetCol] = selectedPiece;

        //     document.getElementById(`${selectedPiece.row}-${selectedPiece.col}`).innerHTML = '';
        //     targetCell.innerHTML = selectedPiece.icon;

        //     clearHighlights();
        //     selectedPiece = null;
        // }


//         function movePiece(event) {
//     if (!selectedPiece) return;

//     const targetCell = event.target;
//     const [targetRow, targetCol] = targetCell.id.split('-').map(Number);

//     const oldCell = document.getElementById(`${selectedPiece.row}-${selectedPiece.col}`);
//     oldCell.innerHTML = ''; // Clear the piece from the old cell

//     boardState[selectedPiece.row][selectedPiece.col] = null; // Clear the state of the old cell
//     selectedPiece.row = targetRow;
//     selectedPiece.col = targetCol;
//     boardState[targetRow][targetCol] = selectedPiece; // Update the state of the new cell

//     targetCell.innerHTML = selectedPiece.icon; // Place the piece in the new cell

//     clearHighlights();
//     selectedPiece = null;

//     // Reinitialize the event listeners for all pieces
//     pieces.forEach(piece => {
//         const cell = document.getElementById(`${piece.row}-${piece.col}`);
//         cell.innerHTML = piece.icon;
//         cell.addEventListener('click', () => {
//             if (selectedPiece === piece) {
//                 clearHighlights();
//                 selectedPiece = null;
//             } else {
//                 clearHighlights();
//                 selectedPiece = piece;
//                 highlightMoves(piece.getPossibleMoves(boardState));
//             }
//         });
//     });
// }


function movePiece(event) {
    if (!selectedPiece) return;

    const targetCell = event.target;
    const [targetRow, targetCol] = targetCell.id.split('-').map(Number);

    const oldCell = document.getElementById(`${selectedPiece.row}-${selectedPiece.col}`);
    oldCell.innerHTML = ''; // Clear the piece from the old cell

    boardState[selectedPiece.row][selectedPiece.col] = null; // Clear the state of the old cell
    selectedPiece.row = targetRow;
    selectedPiece.col = targetCol;
    boardState[targetRow][targetCol] = selectedPiece; // Update the state of the new cell

    targetCell.innerHTML = selectedPiece.icon; // Place the piece in the new cell

    clearHighlights();
    selectedPiece = null;

    // Reinitialize the event listeners for all pieces
    pieces.forEach(piece => {
        const cell = document.getElementById(`${piece.row}-${piece.col}`);
        cell.innerHTML = piece.icon;
        cell.addEventListener('click', () => {
            clearHighlights();
            selectedPiece = piece;
            highlightMoves(piece.getPossibleMoves(boardState));
        });
    });
}


        pieces.forEach(piece => {
            const cell = document.getElementById(`${piece.row}-${piece.col}`);
            cell.innerHTML = piece.icon;
            cell.addEventListener('click', () => {
                if (selectedPiece === piece) {
                    clearHighlights();
                    selectedPiece = null;
                } else {
                    clearHighlights();
                    selectedPiece = piece;
                    highlightMoves(piece.getPossibleMoves(boardState));
                }
            });
        });
    </script> -->
</body>
</html>
